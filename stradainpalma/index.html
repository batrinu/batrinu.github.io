<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />
    <style>
      body {
          margin: 0;
          overflow: hidden;
      }
      #video-overlay {
          position: absolute;
          pointer-events: none;
      }
    </style>
  </head>
  <body>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
      <a-assets>
        <a-asset-item
          id="box-obj"
          src="https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/data/Box.obj"
        ></a-asset-item>
        <a-asset-item
          id="box-mtl"
          src="https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/data/Box.mtl"
        ></a-asset-item>
      </a-assets>
      <a-marker preset="hiro">
        <a-entity
          obj-model="obj: #box-obj; mtl: #box-mtl"
          scale="0.1 0.1 0.1"
          position="0 0 0"
        ></a-entity>
      </a-marker>
      <a-entity camera></a-entity>
    </a-scene>
    <div id="video-overlay">
      <iframe
        id="youtube-iframe"
        width="480"
        height="360"
        src="https://www.youtube.com/embed/SJOz3qjfQXU"
        frameborder="0"
        allowfullscreen
        style="display:none;"
      ></iframe>
    </div>
    <script>
      const iframe = document.getElementById("youtube-iframe");
      const overlay = document.getElementById("video-overlay");

      const scene = document.querySelector("a-scene");
      const marker = document.querySelector("a-marker");

      scene.addEventListener("renderstart", () => {
        iframe.style.display = "block";
      });

      scene.addEventListener("render", () => {
        const markerVisible = marker.object3D.visible;

        if (markerVisible) {
          const box = marker.querySelector("a-entity");
          const position = box.object3D.getWorldPosition();
          const screenPosition = toScreenPosition(position, scene.camera);

          iframe.style.left = `${screenPosition.x - iframe.offsetWidth / 2}px`;
          iframe.style.top = `${screenPosition.y - iframe.offsetHeight / 2}px`;
        } else {
          iframe.style.display = "none";
        }
      });

      function toScreenPosition(obj, camera) {
        const vector = obj.clone();
        const widthHalf = window.innerWidth / 2;
        const heightHalf = window.innerHeight / 2;

        vector.project(camera);
        vector.x = vector.x * widthHalf + widthHalf;
        vector.y = -(vector.y * heightHalf) + heightHalf;
        vector.z = 0;

        return {
          x: vector.x,
          y: vector.y,
        };
      }
    </script>
  </body>
</html>
