<!DOCTYPE html>
<html>

<head>
	<title>AR.js A-Frame</title>
	<script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
	<script type='text/javascript' src='./ar-threex-location-only.js'></script>
	<script type='text/javascript' src='./aframe-ar.js'></script>
	<script src="https://unpkg.com/aframe-html-shader@0.2.0/dist/aframe-html-shader.min.js"></script>
	<script src=".build.js"></script>

	<script>
		function createEntity(latitude, longitude, color) {
			const entity = document.createElement("a-entity");
			entity.setAttribute("material", `shader: html; target: #htmlElement;`);
			entity.setAttribute("geometry", "primitive: box");
			entity.setAttribute("gps-new-entity-place", `latitude: ${latitude}; longitude: ${longitude};`);
			entity.setAttribute("scale", "20 20 20");
			document.querySelector("a-scene").appendChild(entity);
		}

		function createEntities(latitude, longitude) {
			createEntity(latitude + 0.001, longitude, "red");
			createEntity(latitude - 0.001, longitude, "yellow");
			createEntity(latitude, longitude + 0.001, "blue");
			createEntity(latitude, longitude - 0.001, "green");
		}
		function createMenu(latitude, longitude) {
			const menu = document.createElement("a-entity");
			menu.setAttribute("id", "menu");
			menu.setAttribute("class", "screen menu dark");
			menu.setAttribute("htmlembed", "ppu:256");
			menu.setAttribute("gps-new-entity-place", `latitude: ${latitude}; longitude: ${longitude};`);
			menu.setAttribute("rotation", "0 0 0");
			menu.setAttribute("scale", "5 5 5");
			menu.innerHTML = `
							<h2>Menu</h2>
							<ul>
							<li><a href="#" class="button">Home</a></li>
							<li><a href="#slide2" class="button">CSS</a></li>
							<li><a href="#slide3" class="button">Interactivity</a></li>
							<li><a href="#slide4" class="button">Limitations</a></li>
							</ul>
						`;
			return menu;
		}




		function setLocation(latitude, longitude) {
			const gpsCamera = document.querySelector("#gps-camera");
			gpsCamera.setAttribute("gps-new-camera", `gpsMinDistance: 5; simulateLatitude: ${latitude}; simulateLongitude: ${longitude};`);

			const coordinatesDiv = document.querySelector("#coordinates");
			coordinatesDiv.innerHTML = `Latitude: ${latitude.toFixed(6)}<br>Longitude: ${longitude.toFixed(6)}`;


		}

		function onGeolocationSuccess(position) {
			const { latitude, longitude } = position.coords;
			setLocation(latitude, longitude);
			createEntities(latitude, longitude);
			const menu = createMenu(latitude, longitude);
			document.querySelector("#gps-camera").appendChild(menu);


		}

		function onGeolocationError(error) {
			console.warn("Error obtaining geolocation:", error);
		}

		document.addEventListener("DOMContentLoaded", () => {
			if ("geolocation" in navigator) {
				navigator.geolocation.getCurrentPosition(onGeolocationSuccess, onGeolocationError, {
					enableHighAccuracy: true,
					timeout: 5000,
					maximumAge: 0
				});
			} else {
				console.warn("Geolocation is not available on this device");
			}
		});
	</script>


</head>

<body>
	<div id="coordinates" style="position: fixed; top: 10px; left: 10px; color: white; z-index: 100; font-size: 16px;">
	</div>

	<a-scene vr-mode-ui='enabled: false' arjs='sourceType: webcam; videoTexture: true; debugUIEnabled: true'
		renderer='antialias: true; alpha: true'>
		<a-camera id="gps-camera" gps-new-camera="gpsMinDistance: 1">

		</a-camera>
		<!-- Entities will be added dynamically here -->

	</a-scene>

	<div style="width: 100%; height: 100%; position: fixed; left: 0; top: 0; z-index: -1; overflow: hidden">
		<div id="htmlElement" style="background: #F8F8F8; color: #333; font-size: 48px">Hello, HTML!</div>
	  </div>
</body>

</html>