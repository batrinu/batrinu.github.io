<html>
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r122/three.min.js"></script>
    <style>
      #container {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
      }
    </style>
  </head>
  <body>
    <div id="container"></div>
    <script>
      const container = document.getElementById("container");

      navigator.mediaDevices
        .getUserMedia({ video: { facingMode: "environment" } })
        .then((stream) => {
          const video = document.createElement("video");
          video.srcObject = stream;
          video.play();

          const scene = new THREE.Scene();
          const camera = new THREE.PerspectiveCamera(
            75,
            container.offsetWidth / container.offsetHeight,
            0.1,
            1000
          );
          const renderer = new THREE.WebGLRenderer();
          renderer.setSize(container.offsetWidth, container.offsetHeight);
          container.appendChild(renderer.domElement);

          const videoTexture = new THREE.VideoTexture(video);
          videoTexture.minFilter = THREE.LinearFilter;
          videoTexture.magFilter = THREE.LinearFilter;

          const plane = new THREE.PlaneBufferGeometry(2, 2);
          const material = new THREE.MeshBasicMaterial({ map: videoTexture });
          const mesh = new THREE.Mesh(plane, material);
          scene.add(mesh);

          const sphere = new THREE.SphereBufferGeometry(0.1, 32, 32);
          const sphereMaterial = new THREE.MeshBasicMaterial({
            color: 0xffffff,
          });
          const sphereMesh = new THREE.Mesh(sphere, sphereMaterial);
          scene.add(sphereMesh);

          const marker = document.createElement("div");
          marker.style.width = "200px";
          marker.style.height = "200px";
          marker.style.backgroundColor = "red";
          marker.style.position = "absolute";
          marker.style.top = "50%";
          marker.style.left = "50%";
          marker.style.transform = "translate(-50%, -50%)";
          document.body.appendChild(marker);

          const animate = function () {
            requestAnimationFrame(animate);

            sphereMesh.position.z = -0.5;
            mesh.lookAt(camera.position);

            marker.style.left =
              container.offsetWidth / 2 + sphereMesh.position.x * 200 + "px";
            marker.style.top =
              container.offsetHeight / 2 + sphereMesh.position.y * 200 + "px";

            renderer.render(scene, camera);
          };

          animate();
        })
        .catch((error) => {
          console.error("Unable to access camera: ", error);
        });
    </script>
  </body>
</html>
