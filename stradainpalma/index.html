<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>AR with Three.js</title>
    <style>
      #marker {
        position: absolute;
        width: 200px;
        height: 200px;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
      }
    </style>
  </head>
  <body>
    <div id="marker"></div>
    <script src="https://cdn.jsdelivr.net/npm/three@0.119.0/build/three.min.js"></script>
    <script>
      var scene = new THREE.Scene();
      var camera = new THREE.PerspectiveCamera(
        75,
        window.innerWidth / window.innerHeight,
        0.1,
        1000
      );
      var renderer = new THREE.WebGLRenderer({ alpha: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      var marker = document.getElementById("marker");
      marker.innerHTML = "<h1>This is a marker!</h1>";

      var sphereGeometry = new THREE.SphereGeometry(0.1, 32, 32);
      var sphereMaterial = new THREE.MeshBasicMaterial({ color: 0xff0000 });
      var sphere = new THREE.Mesh(sphereGeometry, sphereMaterial);
      scene.add(sphere);

      // Request access to the device's camera
      navigator.mediaDevices
        .getUserMedia({
          video: { facingMode: "environment" },
          audio: false,
        })
        .then(function (stream) {
          var video = document.createElement("video");
          video.srcObject = stream;
          video.setAttribute("playsinline", true);
          video.play();

          var videoTexture = new THREE.VideoTexture(video);
          videoTexture.minFilter = THREE.LinearFilter;
          videoTexture.magFilter = THREE.LinearFilter;
          videoTexture.format = THREE.RGBFormat;

          var videoMaterial = new THREE.MeshBasicMaterial({
            map: videoTexture,
          });
          var videoGeometry = new THREE.PlaneGeometry(2, 2, 2);
          var videoMesh = new THREE.Mesh(videoGeometry, videoMaterial);
          videoMesh.material.side = THREE.DoubleSide;
          scene.add(videoMesh);

          // Animate the scene
          var animate = function () {
            requestAnimationFrame(animate);

            videoMesh.rotation.y = video.currentTime * (Math.PI / 180);
            renderer.render(scene, camera);

            // Set the HTML element's position based on the sphere
            marker.style.left =
              window.innerWidth / 2 + sphere.position.x * 200 + "px";
            marker.style.top =
              window.innerHeight / 2 + sphere.position.y * 200 + "px";
          };

          animate();
        });
    </script>
  </body>
</html>
