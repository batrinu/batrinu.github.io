(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();const m="Au9LWOJrwCz6m3MZdlLxwGr1PRXpM7XGPXWWMrbYSZ3LjiPKDej28s3zp6QmmMiC",y={version:"1.0",elements:{mapElement:{labelVisible:!0},areaPolygon:{fillColor:"#FAEDCD"},waterPolygon:{fillColor:"#00B4D8"},tollRoad:{strokeColor:"#F77F00"},arterialRoad:{strokeColor:"#D62828"},road:{fillColor:"#FFE5D9",strokeColor:"#6D6875"},street:{fillColor:"#FFB4A2",strokeColor:"#E5989B"},structure:{fillColor:"#B5838D",strokeColor:"#6D6875"},vegetation:{fillColor:"#A7C957"}},settings:{landColor:"#D4A373"}};function h(){return new Promise((t,a)=>{if(window.Microsoft&&window.Microsoft.Maps){t();return}const e=document.createElement("script");e.src=`https://www.bing.com/api/maps/mapcontrol?callback=bingMapsLoaded&key=${m}`,e.async=!0,e.defer=!0,e.onerror=()=>a(new Error("Bing Maps script failed to load.")),document.body.appendChild(e),window.bingMapsLoaded=t})}function w(t,a,e){const n=new Microsoft.Maps.Map(t,{center:new Microsoft.Maps.Location(a,e),credentials:"Au9LWOJrwCz6m3MZdlLxwGr1PRXpM7XGPXWWMrbYSZ3LjiPKDej28s3zp6QmmMiC",customMapStyle:y});return Microsoft.Maps.loadModule("Microsoft.Maps.AutoSuggest",()=>{const s={maxResults:5,businessSuggestions:!0,mapBounds:n.getBounds()};new Microsoft.Maps.AutosuggestManager(s).attachAutosuggest("#searchBox","#searchContainer",i=>{const r=i.location;n.setView({center:r,zoom:15});const c=new Microsoft.Maps.Pushpin(r);n.entities.push(c)})}),n}function M(){return new Promise((t,a)=>{navigator.geolocation.getCurrentPosition(t,a)})}function p(t,a,e){const n=new Microsoft.Maps.Location(a,e),s=new Microsoft.Maps.Pushpin(n,{color:"blue"});t.entities.push(s)}const u="restroom_gas_station_data",b=24*7;function C(){const t=localStorage.getItem(u);if(!t)return null;const a=JSON.parse(t);return new Date().getTime()>a.expiry?(localStorage.removeItem(u),null):a.data}function L(t){const e=new Date().getTime()+b*60*60*1e3,n={data:t,expiry:e};localStorage.setItem(u,JSON.stringify(n))}async function E(){const t=C();if(t)return console.log("Using cached data"),t;const s=(await(await fetch(`https://overpass-api.de/api/interpreter?data=${encodeURIComponent(`
      [out:json][timeout:25];
      area["ISO3166-1"="RO"]->.searchArea;
      (
        node["amenity"="toilets"](area.searchArea);
        node["amenity"="fuel"](area.searchArea);
      );
      out body;
    `)}`)).json()).elements.map(o=>({lat:o.lat,lon:o.lon,amenity:o.tags.amenity,tags:{opening_hours:o.tags.opening_hours,wheelchair:o.tags.wheelchair,baby_change:o.tags.baby_change,"toilets:disposal":o.tags["toilets:disposal"],access:o.tags.access,fee:o.tags.fee,brand:o.tags.brand||o.tags.operator}}));return L(s),s}function P(t){let a="";const e={wheelchair:'<i class="fas fa-wheelchair"></i>',fee:'<i class="fas fa-dollar-sign"></i>',access:'<i class="fas fa-universal-access"></i>',"toilets:disposal":'<i class="fas fa-water"></i>',"toilets:position":'<i class="fas fa-map-marker-alt"></i>',opening_hours:'<i class="fas fa-clock"></i>',baby_change:'<i class="fas fa-baby"></i>',brand:'<i class="fas fa-gas-pump"></i>'};for(const[n,s]of Object.entries(t))if(s){const o=e[n]||'<i class="fas fa-tag"></i>',i=n.replace(/_/g," ");a+=`
          <div class="tag">
            ${o} <strong>${i}:</strong> ${s}
          </div>`}return`<div class="dialog-footer">${a}</div>`}async function v(t,a,e){const n=document.getElementById("modal-dialog"),s=n.querySelector(".modal-body"),o=`
      <a 
        href="https://www.google.com/maps/dir/?api=1&destination=${a},${e}" 
        target="_blank" 
        class="directions-button">
        Get Directions
      </a>
    `;s.innerHTML=t+o,n.style.display="block"}function f(){const t=document.getElementById("modal-dialog");t.style.display="none"}function D(){document.querySelector(".close-button").addEventListener("click",f),window.addEventListener("click",a=>{const e=document.getElementById("modal-dialog");a.target===e&&f()})}function B(){const t=document.getElementById("loading-overlay");t.style.display="flex"}function A(){const t=document.getElementById("loading-overlay");t.style.display="none"}function l(t,a){const e=document.querySelector(".progress-fill"),n=document.getElementById("loading-status");e.style.width=`${t}%`,n.textContent=a}async function S(t){B(),l(30,"Loading map..."),await new Promise(e=>setTimeout(e,1e3)),l(60,"Loading public restrooms and gas stations...");const a=await E();l(90,"Placing markers..."),D(),a.forEach(({lat:e,lon:n,amenity:s,tags:o})=>{const i=new Microsoft.Maps.Location(e,n);let r="blue";s==="fuel"&&(r="green");const c=new Microsoft.Maps.Pushpin(i,{color:r});Microsoft.Maps.Events.addHandler(c,"click",()=>{const g=`
          <h3>${s==="fuel"?"LuluPeco":"LuluPipi"}</h3>
          ${o?P(o):"<p>No additional information available</p>"}
        `;v(g,e,n)}),t.entities.push(c)}),l(100,"Complete!"),setTimeout(A,500)}async function I(t){await S(t)}const d={latitude:44.4268,longitude:26.1025},O=document.getElementById("map");async function _(){try{await h();const t=w(O,d.latitude,d.longitude);try{const a=await M(),{latitude:e,longitude:n}=a.coords;t.setView({center:new Microsoft.Maps.Location(e,n),zoom:17}),p(t,e,n)}catch{console.log("Geolocation not available. Using default location."),p(t,d.latitude,d.longitude)}await I(t)}catch(t){console.error("Error loading map:",t)}}_();
