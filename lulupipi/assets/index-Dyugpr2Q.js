(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();const m="Au9LWOJrwCz6m3MZdlLxwGr1PRXpM7XGPXWWMrbYSZ3LjiPKDej28s3zp6QmmMiC",y={version:"1.0",elements:{mapElement:{labelVisible:!0},areaPolygon:{fillColor:"#d9d9d9"},waterPolygon:{fillColor:"#b3d9ff"},tollRoad:{strokeColor:"#ffcc00"},arterialRoad:{strokeColor:"#99ccff"},road:{fillColor:"#f2f2f2",strokeColor:"#a6a6a6"},street:{fillColor:"#ffffff",strokeColor:"#c0c0c0"},structure:{fillColor:"#e6e6e6",strokeColor:"#b3b3b3"},vegetation:{fillColor:"#c6e2b3"},trafficHigh:{strokeColor:"#ff4500"},trafficModerate:{strokeColor:"#ff9900"}},settings:{landColor:"#f0f0f0"}};function h(){return new Promise((e,a)=>{if(window.Microsoft&&window.Microsoft.Maps){e();return}const t=document.createElement("script");t.src=`https://www.bing.com/api/maps/mapcontrol?callback=bingMapsLoaded&key=${m}`,t.async=!0,t.defer=!0,t.onerror=()=>a(new Error("Bing Maps script failed to load.")),document.body.appendChild(t),window.bingMapsLoaded=e})}function w(e,a,t){const n=new Microsoft.Maps.Map(e,{center:new Microsoft.Maps.Location(a,t),credentials:"Au9LWOJrwCz6m3MZdlLxwGr1PRXpM7XGPXWWMrbYSZ3LjiPKDej28s3zp6QmmMiC",customMapStyle:y});return Microsoft.Maps.loadModule("Microsoft.Maps.AutoSuggest",()=>{const s={maxResults:5,businessSuggestions:!0,mapBounds:n.getBounds()};new Microsoft.Maps.AutosuggestManager(s).attachAutosuggest("#searchBox","#searchContainer",i=>{const r=i.location;n.setView({center:r,zoom:15});const c=new Microsoft.Maps.Pushpin(r);n.entities.push(c)})}),n}function M(){return new Promise((e,a)=>{navigator.geolocation.getCurrentPosition(e,a)})}function f(e,a,t){const n=new Microsoft.Maps.Location(a,t),s=new Microsoft.Maps.Pushpin(n,{color:"blue"});e.entities.push(s)}const u="restroom_gas_station_data",b=24*7;function C(){const e=localStorage.getItem(u);if(!e)return null;const a=JSON.parse(e);return new Date().getTime()>a.expiry?(localStorage.removeItem(u),null):a.data}function L(e){const t=new Date().getTime()+b*60*60*1e3,n={data:e,expiry:t};localStorage.setItem(u,JSON.stringify(n))}async function P(){const e=C();if(e)return console.log("Using cached data"),e;const s=(await(await fetch(`https://overpass-api.de/api/interpreter?data=${encodeURIComponent(`
      [out:json][timeout:25];
      area["ISO3166-1"="RO"]->.searchArea;
      (
        node["amenity"="toilets"](area.searchArea);
        node["amenity"="fuel"](area.searchArea);
      );
      out body;
    `)}`)).json()).elements.map(o=>({lat:o.lat,lon:o.lon,amenity:o.tags.amenity,tags:{opening_hours:o.tags.opening_hours,wheelchair:o.tags.wheelchair,baby_change:o.tags.baby_change,"toilets:disposal":o.tags["toilets:disposal"],access:o.tags.access,fee:o.tags.fee,brand:o.tags.brand||o.tags.operator}}));return L(s),s}function v(e){let a="";const t={wheelchair:'<i class="fas fa-wheelchair"></i>',fee:'<i class="fas fa-dollar-sign"></i>',access:'<i class="fas fa-universal-access"></i>',"toilets:disposal":'<i class="fas fa-water"></i>',"toilets:position":'<i class="fas fa-map-marker-alt"></i>',opening_hours:'<i class="fas fa-clock"></i>',baby_change:'<i class="fas fa-baby"></i>',brand:'<i class="fas fa-gas-pump"></i>'};for(const[n,s]of Object.entries(e))if(s){const o=t[n]||'<i class="fas fa-tag"></i>',i=n.replace(/_/g," ");a+=`
          <div class="tag">
            ${o} <strong>${i}:</strong> ${s}
          </div>`}return`<div class="dialog-footer">${a}</div>`}async function E(e,a,t){const n=document.getElementById("modal-dialog"),s=n.querySelector(".modal-body"),o=`
      <a 
        href="https://www.google.com/maps/dir/?api=1&destination=${a},${t}" 
        target="_blank" 
        class="directions-button">
        Get Directions
      </a>
    `;s.innerHTML=e+o,n.style.display="block"}function p(){const e=document.getElementById("modal-dialog");e.style.display="none"}function S(){document.querySelector(".close-button").addEventListener("click",p),window.addEventListener("click",a=>{const t=document.getElementById("modal-dialog");a.target===t&&p()})}function B(){const e=document.getElementById("loading-overlay");e.style.display="flex"}function I(){const e=document.getElementById("loading-overlay");e.style.display="none"}function l(e,a){const t=document.querySelector(".progress-fill"),n=document.getElementById("loading-status");t.style.width=`${e}%`,n.textContent=a}async function k(e){B(),l(30,"Loading map..."),await new Promise(t=>setTimeout(t,1e3)),l(60,"Loading public restrooms and gas stations...");const a=await P();l(90,"Placing markers..."),S(),a.forEach(({lat:t,lon:n,amenity:s,tags:o})=>{const i=new Microsoft.Maps.Location(t,n);let r="blue";s==="fuel"&&(r="green");const c=new Microsoft.Maps.Pushpin(i,{color:r});Microsoft.Maps.Events.addHandler(c,"click",()=>{const g=`
          <h3>${s==="fuel"?"LuluPeco":"LuluPipi"}</h3>
          ${o?v(o):"<p>No additional information available</p>"}
        `;E(g,t,n)}),e.entities.push(c)}),l(100,"Complete!"),setTimeout(I,500)}async function A(e){await k(e)}const d={latitude:44.4268,longitude:26.1025},O=document.getElementById("map");async function _(){try{await h();const e=w(O,d.latitude,d.longitude);try{const a=await M(),{latitude:t,longitude:n}=a.coords;e.setView({center:new Microsoft.Maps.Location(t,n),zoom:17}),f(e,t,n)}catch{console.log("Geolocation not available. Using default location."),f(e,d.latitude,d.longitude)}await A(e)}catch(e){console.error("Error loading map:",e)}}_();
