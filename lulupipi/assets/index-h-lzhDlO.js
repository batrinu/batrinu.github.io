(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function o(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerPolicy&&(a.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?a.credentials="include":t.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(t){if(t.ep)return;t.ep=!0;const a=o(t);fetch(t.href,a)}})();const m="Au9LWOJrwCz6m3MZdlLxwGr1PRXpM7XGPXWWMrbYSZ3LjiPKDej28s3zp6QmmMiC",y={version:"1.0",elements:{mapElement:{labelVisible:!0},areaPolygon:{fillColor:"#d9d9d9"},waterPolygon:{fillColor:"#b3d9ff"},tollRoad:{strokeColor:"#ffcc00"},arterialRoad:{strokeColor:"#99ccff"},road:{fillColor:"#f2f2f2",strokeColor:"#a6a6a6"},street:{fillColor:"#ffffff",strokeColor:"#c0c0c0"},structure:{fillColor:"#e6e6e6",strokeColor:"#b3b3b3"},vegetation:{fillColor:"#c6e2b3"},trafficHigh:{strokeColor:"#ff4500"},trafficModerate:{strokeColor:"#ff9900"}},settings:{landColor:"#f0f0f0"}};function h(){return new Promise((e,s)=>{if(window.Microsoft&&window.Microsoft.Maps){e();return}const o=document.createElement("script");o.src=`https://www.bing.com/api/maps/mapcontrol?callback=bingMapsLoaded&key=${m}`,o.async=!0,o.defer=!0,o.onerror=()=>s(new Error("Bing Maps script failed to load.")),document.body.appendChild(o),window.bingMapsLoaded=e})}function w(e,s,o){const n=new Microsoft.Maps.Map(e,{center:new Microsoft.Maps.Location(s,o),credentials:"Au9LWOJrwCz6m3MZdlLxwGr1PRXpM7XGPXWWMrbYSZ3LjiPKDej28s3zp6QmmMiC",customMapStyle:y});return Microsoft.Maps.loadModule("Microsoft.Maps.AutoSuggest",()=>{const t={maxResults:5,businessSuggestions:!0,mapBounds:n.getBounds()};new Microsoft.Maps.AutosuggestManager(t).attachAutosuggest("#searchBox","#searchContainer",i=>{const r=i.location;n.setView({center:r,zoom:15});const c=new Microsoft.Maps.Pushpin(r);n.entities.push(c),document.getElementById("searchBox").blur()})}),Microsoft.Maps.Events.addHandler(n,"viewchangestart",()=>{const t=document.getElementById("searchBox");t&&t.blur()}),n}function M(){return new Promise((e,s)=>{navigator.geolocation.getCurrentPosition(e,s)})}function p(e,s,o){const n=new Microsoft.Maps.Location(s,o),t=new Microsoft.Maps.Pushpin(n,{color:"blue"});e.entities.push(t)}const u="restroom_gas_station_data",b=24*7;function C(){const e=localStorage.getItem(u);if(!e)return null;const s=JSON.parse(e);return new Date().getTime()>s.expiry?(localStorage.removeItem(u),null):s.data}function L(e){const o=new Date().getTime()+b*60*60*1e3,n={data:e,expiry:o};localStorage.setItem(u,JSON.stringify(n))}async function E(){const e=C();if(e)return console.log("Using cached data"),e;const t=(await(await fetch(`https://overpass-api.de/api/interpreter?data=${encodeURIComponent(`
      [out:json][timeout:25];
      area["ISO3166-1"="RO"]->.searchArea;
      (
        node["amenity"="toilets"](area.searchArea);
        node["amenity"="fuel"](area.searchArea);
      );
      out body;
    `)}`)).json()).elements.map(a=>({lat:a.lat,lon:a.lon,amenity:a.tags.amenity,tags:{opening_hours:a.tags.opening_hours,wheelchair:a.tags.wheelchair,baby_change:a.tags.baby_change,"toilets:disposal":a.tags["toilets:disposal"],access:a.tags.access,fee:a.tags.fee,brand:a.tags.brand||a.tags.operator}}));return L(t),t}function P(e){let s="";const o={wheelchair:'<i class="fas fa-wheelchair"></i>',fee:'<i class="fas fa-dollar-sign"></i>',access:'<i class="fas fa-universal-access"></i>',"toilets:disposal":'<i class="fas fa-water"></i>',"toilets:position":'<i class="fas fa-map-marker-alt"></i>',opening_hours:'<i class="fas fa-clock"></i>',baby_change:'<i class="fas fa-baby"></i>',brand:'<i class="fas fa-gas-pump"></i>'};for(const[n,t]of Object.entries(e))if(t){const a=o[n]||'<i class="fas fa-tag"></i>',i=n.replace(/_/g," ");s+=`
          <div class="tag">
            ${a} <strong>${i}:</strong> ${t}
          </div>`}return`<div class="dialog-footer">${s}</div>`}async function v(e,s,o){const n=document.getElementById("modal-dialog"),t=n.querySelector(".modal-body"),a=`
      <a 
        href="https://www.google.com/maps/dir/?api=1&destination=${s},${o}" 
        target="_blank" 
        class="directions-button">
        Get Directions
      </a>
    `;t.innerHTML=e+a,n.style.display="block"}function g(){const e=document.getElementById("modal-dialog");e.style.display="none"}function B(){document.querySelector(".close-button").addEventListener("click",g),window.addEventListener("click",s=>{const o=document.getElementById("modal-dialog");s.target===o&&g()})}function S(){const e=document.getElementById("loading-overlay");e.style.display="flex"}function I(){const e=document.getElementById("loading-overlay");e.style.display="none"}function l(e,s){const o=document.querySelector(".progress-fill"),n=document.getElementById("loading-status");o.style.width=`${e}%`,n.textContent=s}async function k(e){S(),l(30,"Loading map..."),await new Promise(o=>setTimeout(o,1e3)),l(60,"Loading public restrooms and gas stations...");const s=await E();l(90,"Placing markers..."),B(),s.forEach(({lat:o,lon:n,amenity:t,tags:a})=>{const i=new Microsoft.Maps.Location(o,n);let r="blue";t==="fuel"&&(r="green");const c=new Microsoft.Maps.Pushpin(i,{color:r});Microsoft.Maps.Events.addHandler(c,"click",()=>{const f=`
          <h3>${t==="fuel"?"LuluPeco":"LuluPipi"}</h3>
          ${a?P(a):"<p>No additional information available</p>"}
        `;v(f,o,n)}),e.entities.push(c)}),l(100,"Complete!"),setTimeout(I,500)}async function x(e){await k(e)}const d={latitude:44.4268,longitude:26.1025},A=document.getElementById("map");async function O(){try{await h();const e=w(A,d.latitude,d.longitude);try{const s=await M(),{latitude:o,longitude:n}=s.coords;e.setView({center:new Microsoft.Maps.Location(o,n),zoom:17}),p(e,o,n)}catch{console.log("Geolocation not available. Using default location."),p(e,d.latitude,d.longitude)}await x(e)}catch(e){console.error("Error loading map:",e)}}O();
